<div>
  <h1>Counter</h1>
  <p>
    Current value: <strong id="current-value" aria-live="polite">???</strong>
  </p>
  <button data-increment aria-controls="current-value">Increment</button>
</div>

<script>
  import { counter } from "../contracts/counter";
  import { getPublicKey, signTransaction } from "../stellar-wallets-kit";

  const button = document.querySelector(
    "[data-increment]"
  ) as HTMLButtonElement;
  const currentValue = document.querySelector("#current-value") as HTMLElement;

  button.addEventListener("click", async () => {
    const publicKey = await getPublicKey();
    if (!publicKey) {
      alert("Please connect your wallet first");
      return;
    }

    counter.options.publicKey = publicKey;
    counter.options.signTransaction = signTransaction;

    button.disabled = true;
    currentValue.innerHTML =
      currentValue.innerHTML + "<span> - updating...</span>";

    try {
      const tx = await counter.increment();
      const { result } = await tx.signAndSend();
      currentValue.innerText = result.toString();
    } catch (e) {
      console.error(e);
    } finally {
      button.disabled = false;
    }
  });
</script>
